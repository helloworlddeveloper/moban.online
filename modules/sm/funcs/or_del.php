<?php/** * @Project NUKEVIET 4.x * @Author VINADES.,JSC (contact@vinades.vn) * @Copyright (C) 2017 VINADES.,JSC. All rights reserved * @License GNU/GPL version 2 or any later version * @Createdate 04/18/2017 09:47 */if( !defined( 'NV_IS_MOD_SM' ) ){    die( 'Stop!!!' );}$order_id = $nv_Request->get_int('order_id', 'post,get', 0);$checkss = $nv_Request->get_string('checkss', 'post,get', 0);$contents = "NO_" . $order_id;if ($order_id > 0 and $checkss == md5($order_id . $global_config['sitekey'] . session_id())) {    // Thong tin dat hang chi tiet    $result = $db->query("SELECT * FROM " . NV_PREFIXLANG . "_" . $module_data . "_orders WHERE order_id=" . $order_id);    $data_order = $result->fetch();    if( !empty( $data_order )){        //tru hang hoa trong kho voi don dat hang va chua xac nhan thanh toan        if( $data_order['ordertype']  == 1 && $data_order['status'] < 1 ){            /*            $list_order_i = $listid = $listnum = $listnumgif = array();            $result = $db->query("SELECT * FROM " . NV_PREFIXLANG . "_" . $module_data . "_orders_id WHERE order_id=" . $order_id);            while ($row = $result->fetch()) {                $list_order_i[] = $row['id'];                $listid[] = $row['proid'];                $listnum[] = $row['num'];                $listnumgif[] = $row['numgif'];                $price = $row['price'] * $row['num'];                $quantity = $row['num'];                $quantity_gif = intval( $row['numgif'] );                //ko can tru nua                ////  trukhohanghoa( $data_order['customer_id'], $data_order['depotid'], $row['proid'], $quantity, $quantity_gif, $price, $data_order['chossentype'], $order_id );            }            */            $exec = $db->exec("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_orders_id WHERE order_id=" . $order_id);            if ($exec) {                $exec = $db->exec("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_message_queue WHERE order_id=" . $order_id);                $exec = $db->exec("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_orders WHERE order_id=" . $order_id . " AND status < 1");                if ($exec) {                    $db->query("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_transaction WHERE order_id=" . $order_id);                    $contents = "OK_" . $order_id;                }            }        }elseif( $data_order['ordertype']  == 2  || $data_order['ordertype']  ==  0){            $exec = $db->exec("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_orders_id WHERE order_id=" . $order_id);            if ($exec) {                $db->query("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_message_queue WHERE order_id=" . $order_id);                $db->query("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_transaction WHERE order_id=" . $order_id);                $db->query("DELETE FROM " . NV_PREFIXLANG . "_" . $module_data . "_orders WHERE order_id=" . $order_id);                $contents = "OK_" . $order_id;            }        }    }}$nv_Cache->delMod($module_name);include NV_ROOTDIR . '/includes/header.php';echo $contents;include NV_ROOTDIR . '/includes/footer.php';